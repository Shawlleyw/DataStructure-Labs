

[TOC]







# 一、问题描述

## 1.实验要求

* 输入
  * 任意一张M*N的彩色图
* 工具
  * VC++6.0、VS或者Mac/Linux平台下的其他编译器
  * OpenCV 1.0、2.x、3.x或者4.x
  * 纯C语言或者C/C++语言
* 要求
  * 不允许使用STL标准模板
  * 少用静态数组，多用指针和动态内存分配/释放     
  * 对源码中的文件、函数进行合理划分，保证模块独立性
  * 函数、变量、常量等命名规范（去汉语拼音）
  * 文件、函数宏观注释，核心变量、程序段微观注释
  * 对输入进行合法性校验和功能、容错提示
  * 尽量优化算法，确保低时空复杂度

## 2.实验任务描述

### 2.1 随机取样

​		使用基于种子标记的分水岭算法（cv::watershed）对输入图像进行过分割。用户输入图像和整数K，要求程序自动计算K个随机种子点，确保各种子点之间的距离均大于$\sqrt\frac{MN}{K}$（参考泊松圆盘随机取样算法），然后让程序在原图中标出各种子点的位置及编号 ，并采用半透明+随机着色的方式给出分水岭算法的可视化结果。

### 2.2 四原色

​		使用邻接表统计分水岭结果中各区域的邻接关系，并采用四原色法（合理选择初始着色区域，并基于图的广度优先遍历，采用队列对其他待着色区域进行着色顺利梳理，加速全图着色过程），对分水岭结果重新着色（使用堆栈，优化回退率）

### 2.3 折半查找

​		根据分水岭结果中各区域面积大小的“堆排序”结果，提示最大和最小面积，使用折半查找，用户输入查找范围（面积下界和上界），程序对所有符合要求的分水岭结果进行突出显示。

# 二、实验环境

* Linux archlinux 5.15.5-arch1-1 x86_64 GNU/Linux
* g++ (GCC) 11.1.0
* cmake version 3.20.3

# 三、算法设计

## 1.随机取样

​		随机取种子点代码参考了CSDN网站上给出的解决方案。主要是泊松圆盘随机算法，即在（r，2r）间随即播种获得种子点。但是传统的泊松圆盘难以保证种子点间距大于（M*N/K）^0.5时种子点仍接近输入的K值。于是采取了改进措施，缩小了种子点取样范围，从而使种子点能接近输入的K值。

## 2.四原色

​		本实验是一个四色定理 (Four Color Theorem)的计算机验证实例。

​		首先统计分水岭结果中的区域邻接关系，采用邻接表来进行表示。通过分水岭算法中得到的maskImage中以八邻域的方式获取区域邻接关系，其中-1代表边缘，而大于零的数字代表区域编号。然后优化邻接表，按相邻区域数从大到小排。接下来形成涂色最佳路径，具体是从邻接表中选取相邻区域数最多的表头，基于图的广度优先遍历算法，从该表头遍历，一直到该链表遍历完毕，随后找到从该链表中以未遍历过邻域的结点为表头的结点，又一次遍历到表尾，依此类推形成了涂色最佳路径，其中涂色路径采用队列进行存储。

​		采用队列进行辅助梳理涂色过程，使用堆栈记录涂色过程。创建一个记录颜色是否被用的记录表，创建一个缓冲队列和一个中转站队列，前者用于存储回退出来的区域，后者用来调整缓冲队列的顺序。要求尽可能先用同一种颜色去涂，冲突再换颜色，如果遇到无法涂色，则回退上一步，换颜色再尝试，如果涂色队列非空，即未完成涂色，则继续尝试。每次涂色前，遍历堆栈中所有区域，判断是否有相邻区域涂相同颜色。如果没有，此颜色值入栈，继续赋值；如果有，颜色值增加，再次判断。如果四种颜色值均不满足要求，出栈，重新赋值，直到涂色完成。其中，如果涂色过程一直卡在某个地方，那么回退重新规划路径。

## 3.折半查找

​		折半查找是一种效率比较高的查找方式，但是对数据的结构有要求，即要求数据按某种顺序排列。故我们要先对每个区域的面积进行排序（线性表顺序排序），然后利用排序后获得的线性表进行折半查找。



# 四、实验代码

* 见附件
* 已同步至[wsy727701/DataStructure-Labs: DataStructure-Labs For HUST DS courses (github.com)](https://github.com/wsy727701/DataStructure-Labs)

# 五、实验测试

## 1. 运行说明

* 在工作目录下，依次执行以下命令

> $ mkdir build
>
> $ cd build
>
> $ cmake -E ..
>
> $ make -j \`nproc\`
>
> $ cd ..
>
> $ chmod +x ./run.sh
>
> $ ./run.sh

* run.sh

```shell
#!/bin/bash
./build/ds_course_design ./icon.jpg 1000  2>info.txt
```

修改icon.jpg 即可修改输入图片

## 2. 测试结果

### 2.1 随机取样

![image-20211209235840283](C:\Users\wsy\AppData\Roaming\Typora\typora-user-images\image-20211209235840283.png)

### 2.2 四原色

![image-20211209235847389](C:\Users\wsy\AppData\Roaming\Typora\typora-user-images\image-20211209235847389.png)

### 2.3 折半查找

* e.g. 查询[100, 1000)

![image-20211209235852261](C:\Users\wsy\AppData\Roaming\Typora\typora-user-images\image-20211209235852261.png)

# 六、实验总结

​		通过本实验，练习了代码能力。熟悉了opencv的基本类型以及一些函数接口的使用。

